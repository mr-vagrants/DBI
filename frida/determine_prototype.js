var functions = {
	0x00667665: 2,
0x00677386: 3,
0x0041a9c0: 1,
0x0040a388: 2,
0x00409204: 1,
0x0040a304: 1,
0x0040aa9c: 1,
0x0040aad4: 3,
0x0040ad38: 2,
0x0040ad80: 2,
0x0040adf0: 1,
0x0040ae28: 1,
0x0040b6c0: 1,
0x0040b7e4: 1,
0x00428a21: 5,
0x0042dffc: 2,
0x0042e710: 1,
0x0042e748: 2,
0x0043b328: 1,
0x0042fb74: 3,
0x00431fe8: 1,
0x004320f0: 1,
0x0043213c: 1,
0x00432170: 1,
0x004321a8: 1,
0x00432480: 4,
0x00432f40: 2,
0x00437f54: 1,
0x00438194: 5,
0x0043a87c: 1,
0x0043ac98: 2,
0x0043b054: 1,
0x0043b834: 2,
0x0043c900: 2,
0x0043be5c: 1,
0x0043c2d0: 3,
0x0043bae8: 1,
0x0043bf30: 2,
0x0043c490: 3,
0x0043c6cc: 1,
0x0043ce1c: 2,
0x0043d16c: 2,
0x0043d1a4: 2,
0x0043d4e8: 1,
0x0043d510: 2,
0x0044b5c0: 1,
0x0044bb28: 1,
0x00461da8: 1,
0x00474b3c: 1,
0x0047dc40: 1,
0x0047dcd8: 4,
0x00499a1c: 1,
0x004a892b: 1,
0x004a8939: 1,
0x004a8943: 1,
0x004b96fc: 1,
0x004be9d8: 1,
0x004c10d0: 1,
0x004c5e0c: 1,
0x004c3844: 2,
0x004c53c4: 1,
0x004c6ad4: 1,
0x004c5d88: 1,
0x004c5da4: 2,
0x004c5e50: 2,
0x004c603c: 1,
0x004c60cc: 1,
0x004c6374: 1,
0x004c6510: 2,
0x004c68b4: 2,
0x004c6a00: 1,
0x004c8f4c: 3,
0x004c91cc: 1,
0x004c960c: 1,
0x004c9f88: 1,
0x004c9fd0: 1,
0x004ca064: 1,
0x004ca168: 1,
0x004ca278: 1,
0x004ca3b8: 2,
0x004d7364: 2,
0x004d7138: 1,
0x004d7408: 1,
0x004d7580: 1,
0x004df43c: 1,
0x004d8f34: 1,
0x004d911c: 1,
0x004d9144: 1,
0x004d9178: 1,
0x004d91ac: 1,
0x004ec43c: 2,
0x004ec210: 4,
0x004ec23c: 2,
0x004ec3c8: 4,
0x004ec3f4: 2,
0x00506bec: 1,
0x00506c38: 1,
0x00507060: 1,
0x0050708c: 1,
0x005070cc: 1,
0x00509e90: 2,
0x0053f024: 1,
0x0053f034: 1,
0x0053ff00: 3,
0x00541068: 8,
0x00541420: 1,
0x005414c4: 1,
0x005424a4: 1,
0x00541828: 1,
0x00541880: 6,
0x005421cc: 1,
0x00542430: 3,
0x00542560: 2,
0x005426d0: 1,
0x00542a98: 3,
0x00545c9c: 1,
0x00545d08: 1,
0x00545d7c: 3,
0x00545e7c: 3,
0x00546068: 3,
0x005460d8: 3,
0x005462fc: 3,
0x00546404: 3,
0x00546a64: 1,
0x00546ad8: 4,
0x00546e7c: 1,
0x00547804: 1,
0x00546fe4: 4,
0x005472c8: 3,
0x00547760: 1,
0x005477e0: 2,
0x00547880: 1,
0x00547980: 5,
0x005486d0: 3,
0x005486f4: 2,
0x006379b4: 2,
0x006385c8: 2,
0x00638608: 2,
0x00638b48: 1,
0x00638d38: 2,
0x00638e1c: 2,
0x00638ff0: 1,
0x00639d80: 4,
0x0063a334: 1,
0x0063a9d0: 2,
0x0063acf8: 2,
0x0063af7c: 2,
0x0063b228: 2,
0x0063b308: 2,
0x0063b524: 1,
0x0063b704: 2,
0x00665690: 1,
0x00665a1c: 2,
0x00667208: 2,
0x00667790: 2,
0x00667e38: 2,
0x00667f34: 3,
0x006688cc: 2,
0x00668a24: 2,
0x0066b5e8: 1,
0x0066c9ec: 1,
0x0066c9f8: 1,
0x0066cab4: 2,
0x0066cb20: 2,
0x0066e56c: 1,
0x0066eac4: 1,
0x0066ed10: 1,
0x00670e8c: 2,
0x00671064: 2,
0x00671bcc: 2,
0x0067908c: 1,
0x00676be4: 1,
0x006775a8: 1,
0x0067784c: 1,
0x00677aec: 1,
0x00677b4c: 3,
0x0067859a: 1,
0x006786b8: 3,
0x00678d30: 2,
0x00678d70: 1,
0x0067bbb8: 1,
0x0067c5e8: 1,
0x006a0d84: 1,
0x006a0f70: 1,
0x006aa784: 3,
0x006b7514: 2,
0x006b772c: 3,
0x006b7570: 1,
0x006b7c28: 2,
0x006b7c50: 1,
0x006b9618: 1,
0x006c1004: 1,
0x0070502c: 1,
0x00707a34: 1,
0x0072ece8: 2,
0x007308c0: 1,
0x007308fe: 1,
0x00730928: 1,
0x007309b8: 2,
0x00730dd4: 1,
0x00731920: 1,
0x00733270: 1,
0x007b4240: 1,
0x007e64ac: 2,
0x0080c748: 1,
0x0080ea1c: 1,
0x009ae88c: 2,
0x009b348c: 1,
0x009cee91: 1,
0x009cee9b: 1,
0x009cf9f3: 1,
0x009cfa00: 1,
0x009d2780: 2,
0x009d58f8: 2,
0x009d5664: 2,
0x009d27bc: 2,
0x009d593c: 2,
0x009d5498: 3,
0x009d3030: 1,
0x009d36ac: 1,
0x009d3840: 2,
0x009d399c: 2,
0x009d3c14: 1,
0x009d468c: 1,
0x009d5528: 1,
0x009db430: 1,
0x009dbc70: 1,
0x009dbd64: 1,
0x009dbe1c: 1,
0x009dc134: 1,
0x009dcc34: 1,
0x009dcc63: 1,
0x009dce60: 2,
0x009dd740: 2,
0x00aa6afc: 1,
0x00aa6eb0: 1,
0x00aa6f60: 1,
0x00aa7394: 2,
0x00aa88b8: 1,
0x00aa8d3c: 1,
0x00aa909c: 6,
0x00aac384: 2,
0x00aacf2c: 3,
0x00aad188: 2,
0x00aad2ac: 2,
0x00aad2e8: 2,
0x00aae168: 1,
0x00aae190: 1,
0x00b81370: 1,
0x00ba6064: 1,
0x00ba70b8: 1,
0x00ba8010: 1,
0x00ba896c: 1,
0x00ba9f68: 1,
0x00bab20c: 1,
0x00bac620: 1,
0x00bad13c: 1,
0x00bad3b8: 1,
0x00baf1f0: 1,
0x00bbdd40: 1,
0x00bc2acc: 1,
0x00c36350: 2,
0x00c492d0: 1,
0x00c4ae60: 1,
0x00c50450: 3,
0x00c524f4: 1,
0x00c59fbc: 1,
0x00c5fe58: 1,
0x00c60010: 4,
0x00c626a0: 3,
0x00c6e6f0: 1,
0x00c758b4: 1,
0x00c76d90: 1,
0x00c77148: 1,
0x00c813f8: 1,
0x00c826dc: 1,
0x00c82cb8: 1,
0x00c859a0: 1,
0x00c88b54: 1,
0x00c8ea64: 1,
0x00c94308: 1,
0x00fd101c: 1,

}

var get_int = function(a) { return a }
var get_pointer = function(a) { return String.fromCharCode.apply( null, Memory.readByteArray( ptr(a), 10 ) ) }
var get_double_pointer = function(a) { return get_pointer( Memory.readInt( ptr(a) ) ) }
var get_three_pointer = function(a) { return get_pointer( Memory.readInt( ptr( Memory.readInt( ptr(a) ) ) ) ) }
var arg_types = [get_three_pointer, get_double_pointer, get_pointer, get_int]
var arg_types_name = ['void ***', 'void **', 'void *', 'int']

var args_len, was_catched = false
var exec = function(args)
{
	var value, prototype = [], values = []
	if(! was_catched)
		was_catched = true
	else
		return
	//console.log('exec ' + this.context.eip)
	for(var arg_num = 0; arg_num < args_len; arg_num++)
		for( var arg_type = 0; arg_type < arg_types.length; arg_type++)
		{
			try
			{
				value = arg_types[arg_type] ( args[ arg_num ] )
				prototype[arg_num] = arg_types_name[arg_type]
				values[arg_num] = value
				break
			}
			catch(e){}
		}

	console.log( this.context.eip + '( ' + prototype.join(', ') + ' )')
	console.log( this.context.eip + '( ' + values.join(', ') + ' )')
	callbacks_was_done = true
}

var callbacks_was_done = false
var determine_prototype = function( opts )
{
	var addr = opts.addr, args = opts.args
	args_len = args.length
	callbacks_was_done = false
	was_catched = false
	Interceptor.attach( new NativeFunction( ptr(addr), 'void', args ), { onEnter: exec } )
	//console.log('probe ' + addr)
	var intr = setInterval( function() {
		if(callbacks_was_done)
		{
			clearInterval(intr)
			Interceptor.detachAll()
			prototype_was_determined = true
		}
	}, 1000 )
}

var current_function_index = 0
var get_next_function = function()
{
	var function_index = 0, addr, args
	for( var i in functions )
	{
		if(current_function_index == function_index++)
		{
			try
			{
				addr = i
				args = []
				Memory.readByteArray( ptr(addr), 1 )
				var argc = functions[addr]
				for(var j = 0; j < argc; j++)
					args.push('int')
			}
			catch(e)
			{
				console.log('broken function: ' + addr)
				current_function_index++
			}
			break
		}
	}
	return { addr: addr, args: args }
}

		
var prototype_was_determined = true, timeout = 3000
var intr = setInterval( function() {
	timeout -= 1000
	if(prototype_was_determined)
	{
		//console.log('function â„– ' + current_function_index)
		timeout = 3000
		prototype_was_determined = false
		current_function_index++
		determine_prototype( get_next_function() )
	}
	if(timeout <= 0)
	{
		Interceptor.detachAll()
		prototype_was_determined = true
		current_function_index++
		//console.log('timeout')
	}
}, 1000 )
